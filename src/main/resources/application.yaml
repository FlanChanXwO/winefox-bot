# ===============================================================
#               内部配置文件 (application.yml)
#    此文件包含应用核心配置，可以安全地提交到版本控制系统 (Git)
# ===============================================================

spring:
  # 激活外部/敏感配置文件，命名为 application-secret.yml
  profiles:
    include: secret
  application:
    name: wine-fox-bot-app
  threads:
    virtual:
      enabled: true
  cache:
    type: caffeine # 指定缓存类型为 caffeine
    caffeine:
      spec: > # 使用 spec 字符串进行详细配置
        maximumSize=500,
        expireAfterWrite=10m
  main:
    lazy-initialization: false
  sql:
    init:
      # 开启/关闭数据库初始化 (always, embedded, never)
      mode: always
      # 如果初始化过程中发生错误，是否继续。建议设置为 false，以便及时发现问题。
      continue-on-error: false
      schema-locations: classpath:db/schema-postgres.sql
  datasource:
    # 数据库驱动和连接池配置
    type: com.zaxxer.hikari.HikariDataSource
    driver-class-name: org.postgresql.Driver
    hikari:
      auto-commit: true
      connection-timeout: 30000
      maximum-pool-size: 10
  ai:
    openai:
      chat:
        options:
          # AI模型名称可以在这里定义，如果API Key和URL是外部的
          model: deepseek-chat-search
        completions-path: /v1/chat/completions


setu:
  api:
    # 1. 基础信息
    url: "https://api.lolicon.app/setu/v2"
    # 响应类型：有json和image两种可选
    response-type: json
    # jsonPath 表达式，用于从 API 响应中提取图片 URL
    json-path: "$.data[0].urls.original"

    # 2. API 查询参数配置
    params:
      # 获取图片数量的参数
      # 对应的 URL 参数: num=1
      # 目前只支持参数1
      num:
        key: "num"
        value: "1"

      # 排除 AI 作品的参数
      # 对应的 URL 参数: excludeAI=true
      excludeAI:
        key: "excludeAI"
        value: "true"

      # 按标签搜索的参数
      # 对应的 URL 参数: tag=... (值是动态的，这里只定义 key)
      tag:
        key: "tag"
        # value: "" # 值是动态传入的，可以不配置或留空
      # R18 (成人内容) 开关参数
      # 开启时 URL 参数: r18=1
      # 关闭时 URL 参数: r18=0
      r18:
        key: "r18"
        true-value: "1"
        false-value: "0"

# B站解析功能配置
analysis-bilibili:
  analysisDisplayImage: true
  enable: true
  reanalysisTimeSeconds: 10
  skipVideoAnalysis: false

# 服务器端口
server:
  port: 5000

# 网络代理配置
okhttp:
  proxy:
    type: socks5
    host: 127.0.0.1
    port: 7889
    enabled: on
    no-proxy-hosts:
      - sex.nyan.run
      - api.lolicon.app
      - i.pixiv.re
      - q2.qlogo.cn

# 日志级别
logging:
  level:
    root: info

# MyBatis-Plus 配置
mybatis-plus:
  mapper-locations: classpath:/mapper/**/*.xml
  configuration:
    log-impl: org.apache.ibatis.logging.nologging.NoLoggingImpl
    map-underscore-to-camel-case: true
  type-aliases-package: com.github.winefoxbot.model.entity
  type-aliases-super-type: java.lang.Object
  global-config:
    db-config:
      update-strategy: always
      insert-strategy: always

# 应用自身配置
winefox:
  app:
    version: @project.version@
    update:
      # GitHub仓库地址和JAR包名通常是固定的
      github-repo: "FlanChanXwO/winefox-bot"
      current-jar-name: "winefox-bot.jar"
      github-api-url: "https://api.github.com/repos/{repo}/releases/tags/{tag}"
      release-tag: "latest"

# Shiro 框架配置
shiro:
  pluginScanPath: "plugins"
  task-pool:
    enable-task-pool: false
  ws:
    timeout: 30
    server:
      url: /ws/shiro
      enable: true
    client:
      reconnect-interval: 5
  interceptor: com.github.winefoxbot.aop.interceptor.BotReceiveMsgInterceptor

# JobRunr 任务调度配置
jobrunr:
  background-job-server:
    enabled: true
    thread-type: virtualthreads
    poll-interval-in-seconds: 5
  job-scheduler:
    enabled: true
  dashboard:
    enabled: true
    port: 8000
  jobs:
    default-number-of-retries: 5
