# ===============================================================
#               内部配置文件 (application.yml)
#    此文件包含应用核心配置，可以安全地提交到版本控制系统 (Git)
# ===============================================================

spring:
  # 激活外部/敏感配置文件，命名为 application-secret.yml
  profiles:
    include: secret
  info:
    build:
      encoding: UTF-8
  application:
    name: wine-fox-bot-app
  threads:
    virtual:
      enabled: true
  data:
    redis:
      timeout: 1000ms # Redis 操作超时时间
  main:
    lazy-initialization: false
  sql:
    init:
      # 开启/关闭数据库初始化 (always, embedded, never)
      mode: always
      # 如果初始化过程中发生错误，是否继续。建议设置为 false，以便及时发现问题。
      continue-on-error: false
      schema-locations: classpath:db/schema-postgres.sql
  datasource:
    # 数据库驱动和连接池配置
    driver-class-name: org.postgresql.Driver
    type: com.zaxxer.hikari.HikariDataSource
    hikari:
      auto-commit: true
      connection-timeout: 30000
      maximum-pool-size: 20
  ai:
    openai:
      chat:
        completions-path: /v1/chat/completions
setu:
  api:
    # 1. 基础信息
    url: "https://api.lolicon.app/setu/v2"
    # 响应类型：有json和image两种可选
    response-type: json #建议使用 json 类型，便于后续扩展功能
    # jsonPath 表达式，用于从 API 响应中提取图片 URL
    json-path: "$.data[*].urls.original"

    # 2. API 查询参数配置
    params:
      # 获取图片数量的参数
      # 对应的 URL 参数: num=1
      # 目前只支持参数1
      num:
        key: "num"
        value: "1"

      # 排除 AI 作品的参数
      # 对应的 URL 参数: excludeAI=true
      excludeAI:
        key: "excludeAI"
        value: "true"
      # 按标签搜索的参数
      # 对应的 URL 参数: tag=... (值是动态的，这里只定义 key)
      tag:
        key: "tag"
        # value: "" # 值是动态传入的，可以不配置或留空
      # R18 (成人内容) 开关参数
      # 开启时 URL 参数: r18=1
      # 关闭时 URL 参数: r18=0
      mode:
        key: "r18"
        safe-mode-value: 0
        r18-mode-value: 1
        mix-mode-value: 2
    response:
      r18: # 从返回的响应中获取
        key: "r18"
        value: "true"
        json-path: "$.data[*].r18"

fortune:
  api: "custom" # 使用自定义模式
  # api: "lolicon" # 或者使用预设的 lolicon (代码中已剔除R18参数)

  allow-refresh-jrys: false
  auto-refresh-jrys: true

  # 自定义 API 配置示例 (以 lolicon 为例，但通过 custom 配置)
  custom-api:
    url: "https://api.lolicon.app/setu/v2"
    response-type: JSON
    json-path: "$.data[0].urls.original"
    params:
      static-params:
        - key: "num"
          value: "1"
        - key: "r18"
          value: "0" # 强制非 R18
        - key: "tag"
          value: "碧蓝档案"
        - key: "excludeAI"
          value: "true"
        - key: "size"
          value: "original"

# B站解析功能配置
analysis-bilibili:
  analysisDisplayImage: true
  enable: true
  reanalysisTimeSeconds: 10
  skipVideoAnalysis: false

# 服务器端口
server:
  port: 5000

playwright:
  type: edge

# 网络代理配置
request:
  proxy:
    host: 127.0.0.1
    type: socks5
    port: 7889
    enabled: true
    no-proxy-hosts:
      - localhost
      - 127.0.0.1
      - ::1
      - sex.nyan.run
      - api.lolicon.app
      - i.pixiv.re
      - q2.qlogo.cn
      - multimedia.nt.qq.com.cn
      - 60s.viki.moe
      - bgm.tv
      - v1.hitokoto.cn
      - ithome.com
      - bing.com
      - bilibili.com
      - edge.microsoft.com
      - api.ablai.top

# 日志级别
logging:
  level:
    root: info

# MyBatis-Plus 配置
mybatis-plus:
  mapper-locations: classpath:/mapper/**/*.xml
  configuration:
    log-impl: org.apache.ibatis.logging.nologging.NoLoggingImpl
    map-underscore-to-camel-case: true
  type-aliases-package: com.github.winefoxbot.model.entity
  type-aliases-super-type: java.lang.Object
  global-config:
    db-config:
      update-strategy: always
      insert-strategy: always
# 应用自身配置
winefox:
  app:
    version: @project.version@
    update:
      # GitHub仓库地址和JAR包名通常是固定的
      github-repo: "FlanChanXwO/winefox-bot"
      current-jar-name: "winefox-bot.jar"
      github-api-url: "https://api.github.com/repos/{repo}/releases/latest"
  status:
    # Bot 的名称，会显示在图片中
    bot-name: ${winefox.robot.nickname}
    # 项目名称，会在版本号那行前面出现
    # Dashboard 的名称，会显示在图片中
    dashboard-name: "WineFoxBot"
    # 是否随机选择图片，false 则使用列表中的第一个
    random-image: true
    # 人物立绘图片列表。支持 classpath 和绝对/相对文件路径
    character-images:
      - "classpath:templates/status/res/image/character/1.png"
      - "classpath:templates/status/res/image/character/2.png"
      - "classpath:templates/status/res/image/character/3.png"
      - "classpath:templates/status/res/image/character/4.png"
      - "classpath:templates/status/res/image/character/5.png"
      - "classpath:templates/status/res/image/character/6.png"
      - "classpath:templates/status/res/image/character/7.png"
    # 顶部横幅图片列表。
    top-banner-images:
      - "classpath:templates/status/res/image/banner/top-banner_1.png"
      - "classpath:templates/status/res/image/banner/top-banner_2.png"
      - "classpath:templates/status/res/image/banner/top-banner_3.jpg"

# Shiro 框架配置
shiro:
  pluginScanPath: "plugins"
  task-pool:
    enable-task-pool: false
  ws:
    timeout: 30
    server:
      url: /ws/shiro
      enable: true
  interceptor: com.github.winefoxbot.core.aop.interceptor.ShiroBotMsgInterceptor
  group-event-filter: true
  group-self-bot-event-filter: false


# JobRunr 任务调度配置
jobrunr:
  background-job-server:
    enabled: true
    thread-type: virtualthreads
    poll-interval-in-seconds: 5
  job-scheduler:
    enabled: true
  dashboard:
    enabled: true
  jobs:
    default-number-of-retries: 5

pixiv:
  # API 相关配置
  api:
    # URL模板，{userId}, {offset}, {limit}, {tag} 将被替换
    bookmark-url-template: "https://www.pixiv.net/ajax/user/{userId}/illusts/bookmarks?tag={tag}&offset={offset}&limit={limit}&rest=show&lang=zh"
    limit-per-page: 100 # P站API每页返回的最大数量（最大100）
    unmask-url-template: "https://www.pixiv.net/ajax/illusts/bookmarks/delete" # 取消收藏的URL模板
    download-mirror-host: "i.pixiv.re" # Pixiv图片下载镜像