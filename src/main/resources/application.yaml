# ===============================================================
#               内部配置文件 (application.yml)
#    此文件包含应用核心配置，可以安全地提交到版本控制系统 (Git)
# ===============================================================

spring:
  # 激活外部/敏感配置文件，命名为 application-secret.yml
  profiles:
    include: secret
    active: dev
  info:
    build:
      encoding: UTF-8
  application:
    name: wine-fox-bot-app
  threads:
    virtual:
      enabled: true
  main:
    lazy-initialization: false
  sql:
    init:
      # 开启/关闭数据库初始化 (always, embedded, never)
      mode: always
      # 如果初始化过程中发生错误，是否继续。建议设置为 false，以便及时发现问题。
      continue-on-error: false
      schema-locations: classpath:db/schema-postgres.sql
  datasource:
    # 数据库驱动和连接池配置
    driver-class-name: org.postgresql.Driver
    type: com.zaxxer.hikari.HikariDataSource
    hikari:
      auto-commit: true
      connection-timeout: 30000
      maximum-pool-size: 20
  # Redis配置
  data:
    redis:
      # 连接超时时间(毫秒)
      timeout: 3000
      # Lettuce连接池配置(Spring Boot 4默认使用Lettuce)
      lettuce:
        pool:
          # 最大连接数
          max-active: 20
          # 最大阻塞等待时间(毫秒)
          max-wait: -1
          # 最大空闲连接数
          max-idle: 10
          # 最小空闲连接数
          min-idle: 5
  ai:
    openai:
      chat:
        completions-path: /v1/chat/completions
    vectorstore:
      pgvector:
        initialize-schema: true  # 开启自动初始化表结构
        index-type: HNSW
        distance-type: COSINE_DISTANCE
        dimensions: 1536
        max-document-batch-size: 10000 # Optional: Maximum number of documents per batch

# B站解析功能配置
analysis-bilibili:
  analysisDisplayImage: true
  enable: true
  reanalysisTimeSeconds: 10
  skipVideoAnalysis: false

# 服务器端口
server:
  port: 5000

playwright:
  type: edge

# 网络代理配置
request:
  proxy:
    host: 127.0.0.1
    type: socks5
    port: 7889
    enabled: true
    no-proxy-hosts:
      - localhost
      - 127.0.0.1
      - ::1
      - sex.nyan.run
      - api.lolicon.app
      - i.pixiv.re
      - q2.qlogo.cn
      - ginger25.top
      - multimedia.nt.qq.com.cn
      - 60s.viki.moe
      - bgm.tv
      - v1.hitokoto.cn
      - ithome.com
      - bing.com
      - bilibili.com
      - edge.microsoft.com
      - api.ablai.top

# 日志级别
logging:
  level:
    root: info
  config: classpath:logback.xml

# MyBatis-Plus 配置
mybatis-plus:
  mapper-locations: classpath:/mapper/**/*.xml
  configuration:
    log-impl: org.apache.ibatis.logging.nologging.NoLoggingImpl
    map-underscore-to-camel-case: true
  type-aliases-package: com.github.winefoxbot.model.entity
  type-aliases-super-type: java.lang.Object
  global-config:
    db-config:
      update-strategy: always
      insert-strategy: always
# 应用自身配置
winefox:
  app:
    version: @project.version@
    update:
      # GitHub仓库地址和JAR包名通常是固定的
      github-repo: "FlanChanXwO/winefox-bot"
      current-jar-name: "winefox-bot.jar"
      github-api-url: "https://api.github.com/repos/{repo}/releases/latest"


# Shiro 框架配置
shiro:
  pluginScanPath: "plugins"
  task-pool:
    enable-task-pool: false
  ws:
    timeout: 30
    server:
      url: /ws/shiro
      enable: true
  interceptor: com.github.winefoxbot.core.aop.interceptor.ShiroBotMsgInterceptor
  group-event-filter: true
  group-self-bot-event-filter: false


# JobRunr 任务调度配置
jobrunr:
  background-job-server:
    enabled: true
    thread-type: virtualthreads
    poll-interval-in-seconds: 5
  job-scheduler:
    enabled: true
  dashboard:
    enabled: false
  jobs:
    default-number-of-retries: 5

winefoxbot:
  webui:
    # 唯一的恢复码，用于紧急重置或登录，建议随机生成长字符串
     recovery-code: "114514"
     admin:
       # 默认用户名
       username: "admin"
       # 默认密码
       password: "admin"
     jwt-secret: "winefoxbot-webui-secret-key"
  plugins:
    status:
      # Bot 的名称，会显示在图片中
      bot-name: ${winefox.robot.nickname}
      # 项目名称，会在版本号那行前面出现
      # Dashboard 的名称，会显示在图片中
      dashboard-name: "WineFoxBot"
    pixiv:
      # API 相关配置
      api:
        # URL模板，{userId}, {offset}, {limit}, {tag} 将被替换
        limit-per-page: 100 # P站API每页返回的最大数量（最大100）
        bookmark-url-template: "https://www.pixiv.net/ajax/user/{userId}/illusts/bookmarks?tag={tag}&offset={offset}&limit={limit}&rest=show&lang=zh"
        addmark-url-template: "https://www.pixiv.net/ajax/illusts/bookmarks/add" # 收藏的URL模板
        unmark-url-template: "https://www.pixiv.net/ajax/illusts/bookmarks/delete" # 取消收藏的URL模板
        download-mirror-host: "i.pixiv.re" # Pixiv图片下载镜像
    fortune:
      api: "custom" # 使用自定义模式
      auto-refresh-jrys: true
      # 自定义 API 配置示例 (以 lolicon 为例，但通过 custom 配置)
      custom-api:
        url: "https://api.lolicon.app/setu/v2"
        response-type: JSON
        json-path: "$.data[0].urls.original"
        params:
          static-params:
            - key: "num"
              value: "1"
            - key: "r18"
              value: "0" # 强制非 R18
            - key: "excludeAI"
              value: "true"
            - key: "size"
              value: "original"